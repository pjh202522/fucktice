# 信息安全

## 爬虫

批量对互联网进行遍历查询，获取信息的自动化程序。

* 好处：
  获取到大量信息。
* 坏处：
  危害隐私信息，容易坐牢。

### 反爬虫的办法

反爬虫的关键在于阻止被爬虫批量爬取网站内容，反爬虫技术的核心在于不断变更规则，变换各类验证手段。

1. 图片：将关键信息转换为图片，即使是OCR也无法识别
2. java script混淆技术：对网页信息进行加密
3. 验证码
4. 账号密码登录

## 数据加密及密钥

案例1：2011年CSDN密码泄露案件造成大量损失，原因竟是弱鸡程序员用明文储存用户密码。

案例2：另有调查得出，绝大部分互联网用户使用弱口令密码，极易被暴力破解。

结论：对数据进行加密，就是为了保护用户的信息安全，避免被有心人得到信息后造成不必要的损失。

### 数据加密

数据加密就是通过`加密算法E`和`加密密钥k1`将`明文P`转化为无意义的`密文Y`，而接收方将此密文通过`解密算法D`和`解密密钥k2`还原成`明文P`的过程。

密钥是一串未知的比特串，用于配合加解密算法生成密文，密钥通常由密钥中心提供。

在传输过程中，密文Y通过互联网传输，（如有必要）密钥必须通过安全信道传输。

加密过程： `Y = Ek1(P)`
解密过程： `P = Dk2(Y) = Dk2(Ek1(P))`

加密密钥和解密密钥可以是相同的也可以是不同的，由此衍生出两套加密密钥体制：
* 对称密钥密码体制（即加密和解密密钥相同）
* 非对称密钥密码体制

### 对称密钥密码体制

即加密和解密密钥相同，又称常规密钥密码体制。
这种加密系统又称对称密钥系统。

在对称密钥系统中，加密算法、解密算法和密文都是可以公开的，但是必须保证密钥的安全。

为了保证密钥的安全，又出现了两种加密方式：
1. 分组密码：
   密码分为数个组分别加密然后组合，黑客无法通过部分密文和明文来推导出对应的密钥。

   **常见分组密码加密算法：**
   * 数据加密标准DES：
    
     *加密过程：*
     * 将明文P分为每64位一组；

     * 使用一个64位的密钥（实际密钥长度为56位，有8位用于奇偶校验）对每一组进行加密处理，产生一组64位的密文数据；

     * 最后将各组密文串连起来得到整个密文。
     
     *DES的保密性：*
     取决于对密钥的保密，但是由于DES密钥的长度有限，现在56位的DES已不再视为安全。

     *三重DES是对保密性的强化：*
     使用两个DES密钥，先用一个密钥对一组64位明文加密，再用另一组密钥解密，最后对解密结果用第一个密钥加密。
     加密过程：`Y = Ek1( Dk2( Ek1( P )))`

   * 高级加密标准AES：
     
     由美国政府公开征集的加密算法标准。

     *特点：*
     * 分组密码：明文长度128，密文和密钥长度可变（一般取128）
     * 面向二进制的密码算法，可以加密所有计算机数据。
     * 加解密采用不同的算法
     * 使用多次密码技术
     * 广泛应用
    
     密钥长度可变，保密性强，应用广泛是其主要特点。
   
   分组密码加密算法安全性与**数据段长度和密钥长度**有关，数据段越长越难通过密文和明文解析出密钥，密钥越长加密出的数据安全性越强。但同时，长度越长运算复杂度越大。
   
2. 序列密码：
   每次加密使用一次性密钥，一次性密钥从密钥集中随机产生（理论上），密钥间不具有关联性。

   **局限：**
   * 密钥集大小是有限度的，难免会穷尽而使用已使用过的密钥。
   * 密钥集是由算法产生的，密钥之间无法保证完全无关性。
   * 发送端和接收端每次数据传输都要同步密钥。

### 非对称密钥密码体制

在非对称密钥体制中，加密密钥和解密密钥不同，加密密钥也被称为`公钥pk`（可以公开），解密密钥称为`私钥sk`（要保密），私钥虽然由公钥决定，但是不能从公钥推导出私钥。

此外加密和解密算法也都是公开的。

注：
* 加密的安全性取决于密钥的长度和解密的计算量，非对称和对称体制对安全性完全没有影响。
* 非对称加密算法的开销比对称加密算法开销更大，不见得能取缔对称体制。
* 非对称密钥还需要密钥分配协议，分配过程并不比传统加密方式简单。
* 因此非对称密钥体系并不比对称密钥有优势。

解密过程：`Dsk(Y) = Dsk(Epk(X)) = X`

解密算法和加密算法是互逆的，所以也可以用加密算法解密解密算法加密的明文，即：`Epk(Y) = Epk(Dsk(X)) = X`

**对称与非对称的区别：**

* 对称密钥体系可以用同一个密钥进行加密解密，因此可以建立一对一的双向保密通信。
* 而非对称密钥体系因其公钥私钥特征，可以实现多对一的单向保密通信。

**常见非对称密钥加密算法RSA：**
RSA私钥的安全系取决于密钥长度n，当n为1024位二进制数时，RSA私钥的安全性是可以保证的。
n越大，加解密运算的计算复杂度越高。

### 密钥分配

**略**

## 消息摘要和数字签名

### 前置知识——散列函数

散列函数：将一串数据通过算法计算得到一串散列值，这个散列函数是单项变化的，不同的数据可能通过散列算法得到相同的散列值，所以数据和散列值是多对一的关系，因此可以通过数据得到散列值但不能用散列值反向推出数据。

密码散列函数：用于密码学上的散列函数。

### 消息摘要

为了保证在网络上传输的数据的完整性，不被伪造和篡改，可以使用密码散列函数H将明文变化成一串`散列值h1`和明文一起发送给接收方，接收方接受到明文和散列值后，用散列函数将明文转换为`散列值h2`和接收到的h1进行比较，就可以知道接收到数据是否完整。

这个串散列值就被称为消息摘要。

**消息摘要算法的要求：**
* 能作用于任意长度报文
* 产生有限位数的标识信息
* 易于实现
* 具有单向性，消息和标识单向散列计算。
* 具有抗碰撞性，从计算角度讲，任意报文能得到一一对应的消息摘要。
* 即使只修改报文中的任意一位，消息摘要也要有很大的变化。

**常见的密码散列函数：**
* MD5(报文摘要MD.5)：
  通过复杂算法计算出散列后每一位的数据。
  MD5报文摘要的长度为128。
* SHA-1(安全散列算法)：
  比MD5更加安全，但是计算起来更慢。
  SHA-1报文摘要的长度为160。
* HMAC(散列消息鉴别码)：
  使用密钥k对报文P加密，之后使用上面某一种算法散列出报文摘要。
  以上过程可以简称为：HMAC-MDk(P)

消息摘要验证报文完整性过程：

`X ` → `[X || MD(X)1]` 传输至 `[X || MD(X)1]` → `MD(X)2.equals(MD(X)1)` → `X`

**报文鉴别码MAC：**

报文摘要可以验证报文的完整性，防止`被篡改`，但是不能防止`伪造报文`。

~注：因为黑客可以伪造一个报文后，再对伪造报文散列后得到伪造报文摘要，然后一起发送给接收者，接收者用伪造的报文验证伪造的报文摘要显然是不可行的。~

为了防止伪造报文，可以选择对报文摘要进行加密，加密后得到的密文就叫做`报文鉴别码（MAC）`。

加密方式既可以选择对称密钥，也可以选择非对称密钥。

由于黑客没有加密密钥（发送端私钥）k，因此无法伪造发送者的报文鉴别码，这样就实现了对报文真伪的鉴别。

加入报文鉴别码后的报文验证过程：

发送端加密过程：`X` → `[X || MD(X)1]` → `[X || Ek(MD(X)1)]`
接收端解密过程：`[X || Ek(MD(X)1)]` → `[X || Dk(Ek(MD(X)1))]` → `MD(X)2.equals(MD(X)1)` → `X`

### 数字签名

数字签名是只有消息发送方才能产生，别人无法伪造的一段数字串，同时这段数字串能证明发送者发送信息的真实性。

数字签名的作用：
* 接受方**核实**报文是发送方本人发送
* 发送方事后**无法否认**对报文的数字签名
* 接收方无法伪造发送方对报文的数字签名

数字签名的特征：
* 唯一性：该数字签名只能有特定发送者生成。
* 关联性：表示是对特定报文的数字签名。
* 可证明性：表示唯一性和关联性是可以保证的。

**基于RSA数字签名原理：**

实现上，就是使用公开公共密钥加密的报文鉴别码。

发送方用只有自己知道的私钥对报文摘要进行加密的到数字签名并发送给接收方，接收方用公钥对数字签名进行解密，可以同时鉴别是否完整、是否伪造、是否篡改、是否能被发送方否认。

~注：加、解密算法和公钥可以公开，因为私钥不能被公钥推出~

同时实现秘密通信和数字签名：

发送端使用私钥SkA解密报文摘要得到数字签名，再用接收端公钥PkB加密明文和数字签名；接收方接收后用私钥SkB解密出明文和数字签名，再用发送方公钥PkA加密数字签名，验证明文和身份。

加密过程：`Y = Epkb(X || Dska(MD(X)))`
解密过程：`X = Dskb(Y) = X || Dska(MD(X))`

## 身份验证

在互联网中时常存在需要登录验证的场景，这时格外需要确保报文消息的安全性，否则会被黑客截获甚至反向入侵，造成CSDN惨案的再次发生。

身份验证的逐步升级：
1. 明文传输用户密码，服务端比对数据库密码和用户密码（易被黑客截获并使用）。
2. 密文传输用户密码，服务端解密后比对（数据库仍为明文存储，易被入侵）。
3. 密文传输密码，服务端比对数据库加密密码（容易被黑客`重放攻击`）
   ~注：重放攻击指报文传输过程中，C截获A传给B的报文，并将其发送给B，B误以为C就是A向其发送本应发给A的报文。更有甚者C会伪造A的IP地址让B更易被欺骗（称为IP欺骗）。~
4. 引入随机数验证码，明文传回密文密码和随机数，服务端验证随机数和密文密码（同下）。
5. 对收到的随机数和密文密码的报文摘要再加密，服务端解密后验证随机数和密文密码（单向鉴别，但是用户端无法确认服务端身份）。
6. 双向鉴别。

### 双向鉴别

在第五步中，黑客已经无法对报文作出篡改和伪造的行为了，但是仍可以伪装为服务端，套取用户信息。

因此在单项鉴别的基础上，更进一步演化出了双向鉴别来鉴别双方的身份。

**鉴别过程：**
1. 服务端发送明文随机数P;
2. 用户端将随机数P和密文密码PWD的报文摘要加密；
3. 用户端生成随机数Q和加密后的报文摘要一起发送给服务端；
4. 服务端解密报文得到Q和报文摘要，对摘要验证，确定用户端身份；
5. 服务端加密Q和PWD的报文摘要发送回用户端；
6. 用户端解密出报文摘要，验证后确认服务端身份；
7. 双向鉴别成功。

注：以上加密过程中可以使用非对称密钥或者对称密钥，如果使用非对称密钥，则需要在解密时向对方请求公钥。

### 中间人攻击

在A和B的通信过程中，截获双方的通信报文复制一份后再转发给双方的攻击方式，通信双方几乎无法察觉自身通信遭到攻击，威胁性极大。

**攻击过程：**
1. C截获A的请求报文，转发给B；
2. 截获B的随机数验证码R1，转发给A；
3. 截获A用私钥SkA加密的随机数R1并丢弃，并用C自己的私钥SkC加密R1后发送给B；
4. 截获B索要解密公钥的请求，并将自身公钥PkC回传，然后转发b的请求给A；
5. B得到C的公钥后进行验证，验证成功通过鉴别，此时B认为C就是A。
6. B使用C的公钥加密数据Data，并传输给A。
7. C截获A的解密公钥PkA，截获B的数据并用自身私钥解密获取数据Data并复制一份，然后再用A的公钥加密数据Data转发给A。
8. 由此，C可以在A与B的通信中获取到机密数据。

## 无线局域网安全

无线通信不同于有限通信，不受应用环境影响，以无线电波作为媒介实现通信，使通信一方或者双方处在运动中的通信也被称为移动通信。

无线网络就是基于无线通信的，以无线电磁波作为信息传输媒体的网络。

无线局域网就是无线网络下的一个影响范围的分类，范围大致在十几到几十米之间。

### 无线网络的安全问题

1. 由于无线网络是通过无线电波传输数据，在数据传播范围内的所有用户都可以接触到这些数据，存在窃取风险。
2. 无线网络容易受到电磁干扰，使整个无线网路无法使用。
3. 无线移动设备能力有限，以前在有线网络有效的安全方案和技术不能直接运用于无线网络中。
4. 无线网络的移动性使安全管理难度更大

### 无线局域网的开放性

无线局域网具有两种开放性：
1. 频段开放性：有多个无线电波频段可以利用来传输数据
2. 空间开放性：无线电波的传播途径很广。

开放性带来的安全问题：
* 任何终端都可以向其他终端发送数据
* 任何处于无线网络中的终端都可以接收其他终端发送的数据

这就导致`伪造身份`，`窃取数据`，`篡改数据`问题的出现，因此无线局域网安全技术就是实现终端身份鉴别、数据加密、数据完整性检测的技术。

### 无线局域网网络安全标准WEP

WEP协议为当前局域网提供了一个公共密钥，这个公钥即用来鉴别用户身份也用于数据加密。

**WEP加密过程：**
1. 首先对明文P进行CRC-32校验生成出一个ICV校验值，用于检验报文完整性，然后将P和ICV组装为一段信息。
2. 选取一个WEP提供的IV（初始化向量，意味不明的东西）和公共密钥K0作为种子在伪随机数生成器中生成一个一次性密钥Ke用作本次通信的加解密密钥。
3. 用一次性密钥Ke对明文P和ICV加密，得到密文Y。
4. 将IV和密文Y组装为一段报文发送给接收方。

**WEP解密过程：**
1. 接收方获取报文后，分别取出IV和密文Y。
2. 用IV和公共密钥K0作为种子通过伪随机数生成器得到本次通信的一次性密钥Ke。
3. 使用Ke对密文Y解密，得到明文P和ICV校验值。
4. 使用CRC-32检验明文P得到ICV'，比较ICV和ICV'，验证明文完整性。

**WEP的安全缺陷：**
WEP作为一个无线局域网安全性技术，本身难以避免无线网络的安全问题，即同网络内可以监听到数据包，且由于公共密钥公开，也容易伪造通信数据包。此外，细数大概还有以下几种缺陷：
1. WEP提供的IV数量有限，在网络繁忙时容易出现一次性密钥重复使用的情况。
2. 循环冗余检验方式（CRC-32）计算完整性检验值的能力有限。
3. 同一局域网中的终端使用相同密钥，无法确保数据的保密性（截获）。
4. 鉴别身份过程中存在缺陷（伪造）。

## 网络攻击

网络安全受到多种多样的威胁，比如病毒、黑客、网络欺骗、拒绝服务DOS等等。

网络安全问题的出现与各种各样因素有关：
* TCP/IP技术缺陷
* 系统，硬件方面的缺陷
* 用户自身信息安全意识淡薄

**网络信息安全的目标：**
* 可用性：授权用户可用，非授权用户不可用（身份鉴别）。
* 保密性：保证非授权用户不可见网络信息（数据加密）。
* 完整性：始终保证网络信息不被篡改（信息摘要）。
* 不可抵赖性：不能否认曾完成的操作或发布的消息（数字签名）。
* 可控制性：能对网络中传播的信息进行控制。

**五种网络攻击方式：**
* SYN防洪攻击：
  原理：通过发送大量与服务器建立TCP连接的SYN请求，却不回应服务器ACK相应，使连接挂起，造成服务器内存大量消耗，使得服务器的功能停摆。
* Smurf攻击：
  原理：通过向局域网广播地址发送ICMP请求报文，并将源地址设置为攻击目标的IP地址，使得局域网中所有接收到ICMP请求报文的主机向攻击目标发送ICMP响应报文，导致网络堵塞。
* DHCP欺骗攻击：
  原理：终端从局域网的DHCP和DNS服务器获取网络信息，黑客通过伪造DHCP服务器和DNS服务器将攻击目标想要访问网站的IP地址修改为错误的IP地址，达到控制攻击目标访问网络行为的目的。
* ARP欺骗攻击：
  原理：ARP协议用于IP地址和MAC地址的映射关系，局域网内通过MAC地址传输数据，修改路由器的映射表，使攻击目标的IP地址映射为自己的MAC地址，最后使得攻击目标接收到的数据错误发送给黑客。
* 路由项欺骗攻击：
  原理：数据在局域网间传输时会利用路由器的路由表来确定自己传输目标的地址，黑客可以利用RIP路由更新协议，更新路由器的路由表，将攻击目标的局域网指向黑客所在局域网的地址。

## 恶意软件

恶意软件指利用存储介质和网路实现系统间的传播，未经授权的破坏计算机系统完整性的一段程序，具有非授权性和高破坏性的特点。

可根据**独立性**和**自我复制性**分为以下几种恶意软件：

1. 后门程序（非独立、非自我复制）：指某个程序的秘密入口，可以通过该入口秘密启动程序，绕过正常的访问控制过程，达到破坏系统安全的目的。
2. 逻辑炸弹（非独立、非自我复制）：指正常应用程序中的一段代码，会在某个条件达成后（比如删除某个文件）激发，造成严重的后果。例：开发者讹人
3. 特洛伊木马（非自我复制）：如名，主要起到削弱系统安全控制机制。主要特征使里应外合。
4. 蠕虫：能自动执行查找远程系统、建立连接、实施攻击的程序。主要特征是快速的自我复制和传播。
5. Zombie（僵尸）：能秘密控制当前网络中的其他系统，并以此系统作为平台向其他某个特定的系统发起攻击的功能。也能自我复制传播。
6. 狭义上的病毒（非独立）：寄生于其他应用程序能够自我复制的恶意代码。

## 防火墙

概念：防火墙就是由软件和硬件构成的系统，是一种特殊编程的路由器，用来在两个网络之间实施`访问控制策略`，解决内外网络的安全问题。

功能：用来控制外部网络和内部网络之间的网络通信，根据制定的规则`允许`或者`阻止`外部网络的通信进入内部网络

防火墙路由器分为两个部分：分组过滤路由器和应用网关，一个负责根据规则集顺次匹配过滤分组，一个负责解析应用层协议分组在应用层面过滤特定规则。

**无状态分组过滤器：**
从所有的进入的IP分组中筛选出一部分符合用户制定过滤规则的IP分组，并控制该部分分组的传输。

所谓的**无状态**就是不考虑IP分组之间的关系（例如同一源发送的数个请求，同一段数据的分组等）筛选。

过滤规则的属性字段：
* 源IP地址
* 目的IP地址
* 源和目的端口
* 协议类型

**设置过滤规则集的两种方式：**
* 黑名单：列出禁止通过的IP分组类型，而允许其他类型IP分组通过。用于少部分禁止进入的情况。
* 白名单：列出允许通过的IP分组类型，而禁止其他类型IP分组通过。用于少部分允许进入的情况。

## 网络安全协议

### TCP/IP的安全缺陷

1. 源端鉴别问题：无法确认接收到的分组信息中的源IP地址是否属实。
2. 数据传输的保密性问题：缺少对数据的加密机制。
3. 数据传输的完整性问题：缺少对分组完整性校验的机制。
4. 身份鉴别问题：缺乏对访问网站或数据接收端的身份进行鉴别的机制。

IPSec是网络层的安全协议，用于解决上面四个问题。

## VPN

VPN是在internet中建立一条专用传输隧道，保证信息传输的安全。主要使用了隧道传输和加密两种基本技术。

**VPN数据传输过程：**

* VPN定义了两个网络的路由器之间通过Internet的一个隧道，并使用IP-in-IP封装为通过隧道传输的数据报。
* 为了保证保密性，VPN把外发的数据报加密后，封装在另外一个数据报中传输。
* 隧道接收方路由器将接收到的数据报解密后，还原出内层的数据报，然后转发到目标IP地址。